<app-generic-page
  [title]="title"
  [subtitle]="subtitle"
  [loading]="loading()"
  [tabs]="tabs()"
  [activeTabKeyInput]="activeTab()"
  [searchQueryInput]="search()"
  [facets]="facets()"
  [columns]="columns()"
  [data]="data()"
  [total]="total()"
  [pageIndexInput]="pageIndex()"
  [pageSizeInput]="pageSize()"
  [searchPlaceholder]="searchPlaceholder()"
  [primaryAction]="primaryAction()"
  (primaryActionClick)="onPrimaryActionClick()"
  (pageChange)="onPageChange($event)"
  (filtersChange)="onFiltersChange($event)"
  (sortingChange)="onSortingChange($event)"
  (tabChange)="onTabChange($event)"
  (cellAction)="onCellAction($event)"
></app-generic-page>

@if (adjustModalOpen()) {
  <div class="modal modal-open">
    <div class="modal-box max-w-2xl">
      <h3 class="font-bold text-lg">Adjust Stock</h3>
      <div class="mt-4 space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="label"><span class="label-text">SKU</span></label>
            <input class="input input-bordered w-full" [value]="adjustSku()" readonly />
          </div>
          <div>
            <label class="label"><span class="label-text">Warehouse</span></label>
            <input class="input input-bordered w-full" [value]="adjustWarehouseName()" readonly />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="label">
              <span class="label-text">Quantity to Deduct</span>
              <span class="label-text-alt">Available: {{ adjustAvailableQty() }}</span>
            </label>
            <input type="number" min="1" [max]="adjustAvailableQty()" class="input input-bordered w-full" [value]="adjustQty()" (input)="onAdjustQtyInput($event)"/>
            <div class="text-xs text-base-content/60 mt-1">Enter amount to deduct (max: {{ adjustAvailableQty() }})</div>
          </div>
          <div>
            <label class="label"><span class="label-text">Reason</span></label>
            <select class="select select-bordered w-full" [value]="adjustReason()" (change)="onAdjustReasonChange($event)">
              <option value="manual_correction">Manual correction</option>
              <option value="inventory_loss">Inventory loss</option>
              <option value="damage">Damage</option>
              <option value="theft">Theft</option>
              <option value="expired">Expired</option>
              <option value="return_to_supplier">Return to supplier</option>
            </select>
          </div>
        </div>
        <div>
          <label class="label"><span class="label-text">Notes</span></label>
          <textarea class="textarea textarea-bordered w-full" rows="3" [value]="adjustNotes()" (input)="onAdjustNotesInput($event)"></textarea>
        </div>
        @if (adjustError()) {
          <div class="alert alert-error text-sm">{{ adjustError() }}</div>
        }
      </div>
      <div class="modal-action">
        <button class="btn btn-ghost" (click)="closeAdjustModal()" [disabled]="submitting()">Cancel</button>
        <button class="btn btn-accent" (click)="submitAdjustment()" [disabled]="submitting() || adjustQty() <= 0 || adjustQty() > adjustAvailableQty()">
          @if (submitting()) {<span class="loading loading-spinner loading-sm"></span>} Adjust
        </button>
      </div>
    </div>
  </div>
}
