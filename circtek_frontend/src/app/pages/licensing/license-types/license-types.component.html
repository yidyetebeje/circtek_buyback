<app-generic-page
  title=""
  [primaryAction]="isSuperAdmin() ? { label: 'Create License Type' } : null"
  (primaryActionClick)="openCreateModal()"
  [columns]="columns"
  [data]="licenseTypes()"
  [loading]="loading()"
  searchPlaceholder="Search license types..."
/>

<!-- Create License Type Modal -->
@if (showCreateModal()) {
  <app-generic-modal
    [isOpen]="showCreateModal()"
    title="Create License Type"
    size="lg"
    (close)="closeCreateModal()"
    [actions]="[
      { label: 'Cancel', variant: 'ghost', action: 'cancel' },
      { label: 'Create', variant: 'accent', action: 'submit', loading: submitting() }
    ]"
    (actionClick)="$event === 'submit' ? handleCreateSubmit() : closeCreateModal()"
  >
    <form [formGroup]="createForm" class="space-y-4">
      @if (errorMessage()) {
        <div class="alert alert-error">
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <div>
        <label class="label">
          <span class="label-text font-medium">Name <span class="text-error">*</span></span>
        </label>
        <input
          type="text"
          formControlName="name"
          class="input input-bordered w-full"
          [class.input-error]="createForm.get('name')?.invalid && createForm.get('name')?.touched"
          placeholder="e.g., iPhone Diagnostic License"
        />
        @if (getFieldError('name'); as error) {
          <div class="label">
            <span class="label-text-alt text-error">{{ error }}</span>
          </div>
        }
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="label">
            <span class="label-text font-medium">Product Category <span class="text-error">*</span></span>
          </label>
          <select
            formControlName="product_category"
            class="select select-accent w-full"
            [class.select-error]="createForm.get('product_category')?.invalid && createForm.get('product_category')?.touched"
          >
            <option value="" disabled selected>Select category</option>
            <option value="iPhone">iPhone</option>
            <option value="Macbook">MacBook</option>
            <option value="Airpods">AirPods</option>
            <option value="Android">Android</option>
          </select>
          @if (getFieldError('product_category'); as error) {
            <div class="label">
              <span class="label-text-alt text-error">{{ error }}</span>
            </div>
          }
        </div>

        <div>
          <label class="label">
            <span class="label-text font-medium">Test Type <span class="text-error">*</span></span>
          </label>
          <select
            formControlName="test_type"
            class="select select-accent w-full"
            [class.select-error]="createForm.get('test_type')?.invalid && createForm.get('test_type')?.touched"
          >
            <option value="" disabled selected>Select type</option>
            <option value="Diagnostic">Diagnostic</option>
            <option value="Erasure">Erasure</option>
          </select>
          @if (getFieldError('test_type'); as error) {
            <div class="label">
              <span class="label-text-alt text-error">{{ error }}</span>
            </div>
          }
        </div>
      </div>

      <div>
        <label class="label">
          <span class="label-text font-medium">Price (USD) <span class="text-error">*</span></span>
        </label>
        <input
          type="number"
          formControlName="price"
          class="input input-bordered w-full"
          [class.input-error]="createForm.get('price')?.invalid && createForm.get('price')?.touched"
          placeholder="0.00"
          step="0.01"
          min="0"
        />
        @if (getFieldError('price'); as error) {
          <div class="label">
            <span class="label-text-alt text-error">{{ error }}</span>
          </div>
        }
      </div>

      <div>
        <label class="label">
          <span class="label-text font-medium">Description</span>
        </label>
        <textarea
          formControlName="description"
          class="textarea textarea-bordered w-full"
          placeholder="Optional description..."
          rows="3"
        ></textarea>
      </div>
    </form>
  </app-generic-modal>
}
