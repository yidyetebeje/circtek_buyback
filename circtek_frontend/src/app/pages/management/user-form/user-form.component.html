<app-generic-form-page
  [title]="title()"
  [subtitle]="subtitle()"
  [form]="userForm()"
  [fields]="fields()"
  [actions]="actions()"
  [loading]="pageLoading()"
  [submitting]="submitting()"
  [error]="errorMessage()"
  [showBackButton]="true"
  [submitLabel]="submitLabel()"
  backUrl="/management"
  (formSubmit)="onFormSubmit($event)"
  (actionClick)="onActionClick($event)"
  (backClick)="onBackClick()"
>
  <!-- Loading and error states for data loading -->
  @if (tenantsLoading() && isSuperAdmin()) {
    <div class="alert alert-info mb-4">
      <div class="flex items-center gap-2">
        <span class="loading loading-spinner loading-sm"></span>
        <span>Loading tenants...</span>
      </div>
    </div>
  }
  
  @if (tenantsError()) {
    <div class="alert alert-error mb-4">
      <span>{{ tenantsError() }}</span>
      <button 
        type="button" 
        class="btn btn-sm btn-outline btn-error ml-2"
        (click)="loadTenantOptions()"
      >
        Retry
      </button>
    </div>
  }
  
  @if (warehousesLoading()) {
    <div class="alert alert-info mb-4">
      <div class="flex items-center gap-2">
        <span class="loading loading-spinner loading-sm"></span>
        <span>Loading warehouses...</span>
      </div>
    </div>
  }
  
  @if (warehousesError()) {
    <div class="alert alert-error mb-4">
      <span>{{ warehousesError() }}</span>
      <button 
        type="button" 
        class="btn btn-sm btn-outline btn-error ml-2"
        (click)="loadWarehousesForTenant(isSuperAdmin() ? selectedTenantId() : null)"
      >
        Retry
      </button>
    </div>
  }
  
  @if (isSuperAdmin() && !selectedTenantId()) {
    <div class="alert alert-info mb-4">
      <span>ðŸ‘† Please select a tenant first to see available warehouses for that tenant.</span>
    </div>
  }
  
  @if (showNoWarehousesMessage()) {
    <div class="alert alert-warning mb-4">
      <span>
        @if (isSuperAdmin()) {
          No active warehouses found for the selected tenant. Please ensure the tenant has at least one active warehouse.
        } @else {
          No active warehouses found for your tenant. Please contact your administrator.
        }
      </span>
    </div>
  }
  
  @if (successMessage()) {
    <div class="alert alert-success">
      <span>{{ successMessage() }}</span>
    </div>
  }
</app-generic-form-page>

<!-- Confirmation Modal -->
<app-generic-modal
  [isOpen]="showConfirmModal()"
  [title]="'Confirm Update'"
  [actions]="confirmModalActions()"
  [closable]="!submitting()"
  (close)="showConfirmModal.set(false)"
  (actionClick)="onConfirmModalAction($event)"
>
  <p class="text-base-content/80 mb-4">
    Are you sure you want to update this user? This action will modify the user's information.
  </p>
  
  <div class="bg-base-200 rounded-lg p-4">
    <h4 class="font-medium mb-2">Changes to be saved:</h4>
    @if (pendingFormData(); as data) {
      <ul class="text-sm space-y-1">
        <li><strong>Name:</strong> {{ data.name }}</li>
        <li><strong>Username:</strong> {{ data.user_name }}</li>
        <li><strong>Status:</strong> {{ data.status ? 'Active' : 'Inactive' }}</li>
      </ul>
    }
  </div>
</app-generic-modal>
